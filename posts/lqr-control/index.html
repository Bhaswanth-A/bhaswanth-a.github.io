<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Thruster Control of AUV Using LQR" /><meta name="author" content="<author_id>" /><meta property="og:locale" content="en" /><meta name="description" content="Abstract" /><meta property="og:description" content="Abstract" /><link rel="canonical" href="https://bhaswanth-a.github.io//posts/lqr-control/" /><meta property="og:url" content="https://bhaswanth-a.github.io//posts/lqr-control/" /><meta property="og:site_name" content="Bhaswanth Ayapilla" /><meta property="og:image" content="https://bhaswanth-a.github.io//assets/images/Thumbnail/lqr.png" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-08-11T12:00:00-04:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://bhaswanth-a.github.io//assets/images/Thumbnail/lqr.png" /><meta property="twitter:title" content="Thruster Control of AUV Using LQR" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@<author_id>" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"<author_id>"},"dateModified":"2024-12-13T17:24:47-05:00","datePublished":"2022-08-11T12:00:00-04:00","description":"Abstract","headline":"Thruster Control of AUV Using LQR","image":"https://bhaswanth-a.github.io//assets/images/Thumbnail/lqr.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://bhaswanth-a.github.io//posts/lqr-control/"},"url":"https://bhaswanth-a.github.io//posts/lqr-control/"}</script><title>Thruster Control of AUV Using LQR | Bhaswanth Ayapilla</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Bhaswanth Ayapilla"><meta name="application-name" content="Bhaswanth Ayapilla"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/images/prfl.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Bhaswanth Ayapilla</a></div><div class="site-subtitle font-italic">Perception | Reinforcement Learning</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-user ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT ME</span> </a><li class="nav-item"> <a href="/projects/" class="nav-link"> <i class="fa-fw fas fa-book ml-xl-3 mr-xl-3 unloaded"></i> <span>PROJECTS</span> </a><li class="nav-item"> <a href="/cmu/" class="nav-link"> <i class="fa-fw fas fa-school ml-xl-3 mr-xl-3 unloaded"></i> <span>CMU MRSD</span> </a><li class="nav-item"> <a href="/blog/" class="nav-link"> <i class="fa-fw fas fa-blog ml-xl-3 mr-xl-3 unloaded"></i> <span>BLOG</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/cv/" class="nav-link"> <i class="fa-fw fas fa-file ml-xl-3 mr-xl-3 unloaded"></i> <span>CURRICULUM VITAE</span> </a><li class="nav-item"> <a href="/contact/" class="nav-link"> <i class="fa-fw fas fa-address-book ml-xl-3 mr-xl-3 unloaded"></i> <span>CONTACT</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/Bhaswanth-A" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['bhaswanthayapilla','gmail.com'].join('@')" aria-label="email" class="order-4" > <i class="fas fa-envelope"></i> </a> <a href="https://www.instagram.com/bhaswanth_a/" aria-label="instagram" class="order-5" target="_blank" rel="noopener"> <i class="fab fa-instagram"></i> </a> <a href="https://www.linkedin.com/in/bhaswanth-a/" aria-label="linkedin" class="order-6" target="_blank" rel="noopener"> <i class="fab fa-linkedin-in"></i> </a> <a href="https://bhaswanth-a.github.io/cv/" aria-label="cv" class="order-7" target="_blank" rel="noopener"> <i class="fas fa-file"></i> </a> <span id="mode-toggle-wrapper" class="order-1"> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script> </span></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Thruster Control of AUV Using LQR</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Thruster Control of AUV Using LQR</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1660233600" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Aug 11, 2022 </em> </span> <span> Updated <em class="" data-ts="1734128687" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Dec 13, 2024 </em> </span><div class="d-flex justify-content-between"> <span> By <em> Bhaswanth Ayapilla </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="4256 words"> <em>23 min</em> read</span></div></div></div><div class="post-content"><h1 id="abstract"><strong>Abstract</strong></h1><ul><li>To make two different control system models in Simulink on PID and LQR controllers respectively and to get the results for positional and velocity parameters of the ROV based on the desired reference inputs.<li>To tune parameters related to both the controllers to achieve better results and finally test the model physically underwater.</ul><h1 id="pid-controller"><strong>PID Controller</strong></h1><h2 id="literature-review"><span class="mr-2"><strong>Literature Review</strong></span><a href="#literature-review" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>The basic mathematical model of an ROV is given by:</p>\[\dot{\eta}=J(\eta)v \newline M\dot{v}+C(v)v + D(v)v + g(\eta)=\tau\]<ul><li>where M = Mass matrix (with added mass effect taken into account)<li>C = Coriolis force matrix<li>D = Damping forces matrix<li>g = Restoring forces matrix<li>$\tau$ = Forces &amp; moments matrix</ul><p><strong>1. Added Mass Effect:</strong></p><p>The added mass of an object is the effect in which some mass of fluid surrounding the object under observation is accelerated/decelerated along with it.</p><p><strong>2. Coriolis Effect:</strong></p><p>The Coriolis force is a fictitious force that comes into play whenever we are trying to explain the forces on an object with respect to a rotating frame.</p><p><strong>3. Ziegler-Nichols Method for tuning PIDs:</strong></p><p>This method can be used to tune our PID both in the case where we have a working model for our plant or even when we don‚Äôt. The first step to this method is measuring two parameters: KU which is the gain at which the system becomes marginally stable and TU which is the period of oscillation at marginal system response. These values are found by taking KI and KD values to be zero for that input and changing KP until marginal stability is achieved.</p><p>After these parameters are evaluated controller gains can simply be calculated from the below table:</p><p><img data-src="/assets/images/LQR%20Control%20of%20AUV%204aba9c1df2884d07bff286c247bf3d93/Untitled.png" alt="Untitled" data-proofer-ignore></p><p><strong>4. Controller Models:</strong></p><p>The two controller models that we used are:</p><ol><li>Linear Model<li>Non-linear Model</ol><h2 id="linear-model"><span class="mr-2"><strong>Linear Model</strong></span><a href="#linear-model" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>The schematic of the simulink model created using the linear PID control looks like this:</p><p><img data-src="/assets/images/LQR%20Control%20of%20AUV%204aba9c1df2884d07bff286c247bf3d93/Untitled%201.png" alt="Untitled" data-proofer-ignore></p><p>It consists of different functionalities in each block of the design:</p><p><img data-src="/assets/images/LQR%20Control%20of%20AUV%204aba9c1df2884d07bff286c247bf3d93/Untitled%202.png" alt="Untitled" data-proofer-ignore></p><p>The PID controller uses an error signal, called the tracking error, generated from the difference between the desired position and the current position of the rover.</p>\[e = \eta_d - \eta\]<p>This error signal, in the world frame, is converted to the error signal in body frame ùëíb using the following equation:</p>\[e^b = J^T(\eta)e\]<p>where the transformation matrix from the vehicle body frame to the world reference frame using Euler angle transformation is given by:</p>\[J_\theta(\eta) = \begin{bmatrix} R^n_b(\theta) &amp; 0_{3x3} \\ 0_{3x3}&amp; T_\theta(\theta) \end{bmatrix}\]<p><img data-src="/assets/images/LQR%20Control%20of%20AUV%204aba9c1df2884d07bff286c247bf3d93/Untitled%203.png" alt="Untitled" data-proofer-ignore></p><p>Using the error signal in the body frame ùëíb, the torque generated by the PID can be calculated using the equation:</p>\[\tau_{P I D}=K_P e^b(t)+K_I \int_0^t e^b\left(t^{\prime}\right) d t^{\prime}+K_D \frac{d e^b(t)}{d t}\]<p>In order to generalise the required control forces, control allocation calculates the control input signal u to apply to the thrusters. The control forces due to the control inputs applied to the thrusters can be expressed as:</p>\[\tau = T(\alpha)F = T(\alpha)Ku\]<p>As a result, the control input vector can be derived as:</p>\[u = K^{-1}T^{-1}\tau\]<p>For the linear model, the following values of KP, KI, and KD have been obtained using the Ziegler-Nichols method:</p><div class="table-wrapper"><table><thead><tr><th>6-DoF PID<th>Surge<th>Sway<th>Heave<th>Roll<th>Pitch<th>Yaw<tbody><tr><td>KP<td>3<td>3<td>3<td>4<td>4<td>2<tr><td>KI<td>0.2<td>0.2<td>0.2<td>0.3<td>0.3<td>0.1<tr><td>KD<td>2.5<td>2.5<td>0.5<td>0.5<td>1<td>0.5</table></div><p><img data-src="/assets/images/LQR%20Control%20of%20AUV%204aba9c1df2884d07bff286c247bf3d93/Untitled%204.png" alt="Untitled" data-proofer-ignore></p><p>Using the control input vector, the thruster system generates the control forces in 6 DoFs with the help of the above mentioned equation $\tau = T(\alpha)F = T(\alpha)Ku$</p><p>Since the 8 thrusters of the ROV produce a maximum thrust of 40N at operating voltage of 16V, the thrust coefficients are approximated to 40. Thus the thrust coefficient matrix <strong>ùêæ</strong> is taken as</p><p>$K = diag[40,40, 40,40,40,40,40,40]$</p><p>After obtaining the torque vector, the kinetics is used to determine the acceleration in the body frame for the given forces using the state equation:</p>\[M\dot{v}+C(v)v + D(v)v + g(\eta)=\tau\]<p>The kinematics block is then used to define the vehicle velocity in the world frame <strong>ùë£<em>n</em></strong>. The position of the vehicle is then determined in the integrator and, using inverse kinematics, is converted to the body frame before being supplied back into the controller.</p><h2 id="non-linear-model"><span class="mr-2"><strong>Non-Linear Model</strong></span><a href="#non-linear-model" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Because of disturbances underwater like current speed, there will be non-linearities introduced into the system. This makes the linear-PID controller model inappropriate to use as there will be a lot of deviations from the desired o/p and noise in the system. So, we need to include the system dynamics to get the control input to the thrusters.</p><p>In the nonlinear model-based PID control system design, the dynamic model of the ROV is utilized to produce a 6-DoF predictive force and the model-based PID is used to provide a corrective force in 6 DoFs to adjust the error in the model. This is advantageous in that the model error and non-linearities tend to be smaller than the dynamics themselves.</p><p>In the predictive force generation, a virtual reference trajectory strategy is introduced for the design of trajectory tracking. With the use of a scalar measure of tracking in Fossen (Fossen, 1994), a virtual reference $x_r$ can be defined that satisfies:</p>\[\dot{x_r}=\dot{x_d}+\lambda e^b\]<p>where $\lambda$ &gt; 0 is the control bandwidth that describes the amount of tracking error to the overall tracking performance, and $e^b$ is the tracking error in the body frame.</p><p>Since the velocity $v$ is the time derivative of the position (i.e. $v=\dot{\eta}$), for a defined virtual reference position $\eta_r$, the following is satisfied:</p>\[v_r=v_d+\lambda e^b\]<p>So, $\lambda$ is used to tune the 6-DoF predictive force.</p><p>This is shown in the following block:</p><p><img data-src="/assets/images/LQR%20Control%20of%20AUV%204aba9c1df2884d07bff286c247bf3d93/Untitled%205.png" alt="Untitled" data-proofer-ignore></p><p>Where ‚ÄòA‚Äô is the new controller output.</p><p>The PID controller gains(Kp, Ki and Kd) for the non-linear model are found out by Ziegler Nichols method and were found out to be as follows:</p><p><img data-src="/assets/images/LQR%20Control%20of%20AUV%204aba9c1df2884d07bff286c247bf3d93/Untitled%206.png" alt="Untitled" data-proofer-ignore></p><p>Finally, the control law for the nonlinear model-based PID controller is computed given by:</p>\[\begin{aligned}\tau= &amp; M\left(v_d+\lambda\left(v_d-v\right)\right)+C_{R B}(v) v+C_A\left(v_w\right) v_w+D\left(v_w\right)\left(v_d+\lambda e^b-v_c\right)+g(\eta) \\&amp; +K_P e^b(t)+K_I \int_0^t e^b\left(t^{\prime}\right) d t^{\prime}+K_D \frac{d e^b(t)}{d t}\end{aligned}\]<p>The final model for this system is shown below:</p><p><img data-src="/assets/images/LQR%20Control%20of%20AUV%204aba9c1df2884d07bff286c247bf3d93/Untitled%207.png" alt="Untitled" data-proofer-ignore></p><p>Here, we took desired position input as $[1;1;2;0;0;0]$.</p><h1 id="pid-implementation">PID <strong>Implementation</strong></h1><p>We implemented the models for both the controllers above and got the following results when we give a desired positional input:</p><h2 id="linear-controller-model"><span class="mr-2"><strong>Linear Controller Model</strong></span><a href="#linear-controller-model" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Using the above method, we have obtained the following results for a desired position input: $\eta_d=[3;4;1;1.57;0;0]$.</p><p>The output of the position and orientation control is obtained as follows:</p><p><strong>Position X:</strong></p><p><em>Desired output:</em> 3 m</p><p><em>Obtained result:</em></p><p><img data-src="/assets/images/LQR%20Control%20of%20AUV%204aba9c1df2884d07bff286c247bf3d93/Untitled%208.png" alt="Untitled" data-proofer-ignore></p><p>The steady state response final value = 3.</p><p><strong>Position Y:</strong></p><p><em>Desired output:</em> 4 m</p><p><em>Obtained result:</em></p><p><img data-src="/assets/images/LQR%20Control%20of%20AUV%204aba9c1df2884d07bff286c247bf3d93/Untitled%209.png" alt="Untitled" data-proofer-ignore></p><p>The steady state response final value = 4.</p><p><strong>Position Z:</strong></p><p><em>Desired output:</em> 1 m</p><p><em>Obtained result:</em></p><p><img data-src="/assets/images/LQR%20Control%20of%20AUV%204aba9c1df2884d07bff286c247bf3d93/Untitled%2010.png" alt="Untitled" data-proofer-ignore></p><p>The steady state response final value = 1.</p><p><strong>Orientation $\phi$:</strong></p><p><em>Desired output:</em> 1.57 radians</p><p><em>Obtained result:</em></p><p><img data-src="/assets/images/LQR%20Control%20of%20AUV%204aba9c1df2884d07bff286c247bf3d93/Untitled%2011.png" alt="Untitled" data-proofer-ignore></p><p>The steady state response final value = 1.57.</p><p><strong>Orientation $\theta$:</strong></p><p><em>Desired output:</em> 0 radians</p><p><em>Obtained result:</em></p><p><img data-src="/assets/images/LQR%20Control%20of%20AUV%204aba9c1df2884d07bff286c247bf3d93/Untitled%2012.png" alt="Untitled" data-proofer-ignore></p><p>The steady state response final value = 0.</p><p><strong>Orientation $\psi$:</strong></p><p><em>Desired output:</em> 0 radians</p><p><em>Obtained result:</em></p><p><img data-src="/assets/images/LQR%20Control%20of%20AUV%204aba9c1df2884d07bff286c247bf3d93/Untitled%2013.png" alt="Untitled" data-proofer-ignore></p><p>The steady state response final value = 3.</p><p>The control inputs to the thrusters for the same are represented in the plots below:</p><p><img data-src="/assets/images/LQR%20Control%20of%20AUV%204aba9c1df2884d07bff286c247bf3d93/Untitled%2014.png" alt="Untitled" data-proofer-ignore></p><p>As it is evident from the plots, each thruster is instructed to provide the required thrust every instant for a finite period of time after which the control input eventually settles down to a final value.</p><p>The model of the rover under study somewhat looks like this:</p><p><img data-src="/assets/images/LQR%20Control%20of%20AUV%204aba9c1df2884d07bff286c247bf3d93/Untitled%2015.png" alt="Untitled" data-proofer-ignore></p><p>Here, the thrusters 1,2,3,4 are used in the position control in the X,Y directions while 5,6,7,8 are used for the Z-directional control. If we see the plots for the thruster control inputs for 1,2,3,4:</p><p><img data-src="/assets/images/LQR%20Control%20of%20AUV%204aba9c1df2884d07bff286c247bf3d93/image.png" alt="image.png" data-proofer-ignore></p><p>We can observe the steady state final value to be zero for all the thrusters 1,2,3,4.</p><p><strong><em>Reason:</em></strong> The above thrusters are used for controlling the position in X,Y directions and their respective control inputs drive them to work in a synchronised manner so as to reach the respective position. Once the rover has reached the required X,Y, coordinates of the position with the required orientation, there is no need for them to provide any more thrust given the lack of any external force acting in the X,Y directions.</p><p>The interesting part comes when we observe the control input plots for the thrusters 5,6,7,8:</p><p><img data-src="/assets/images/LQR%20Control%20of%20AUV%204aba9c1df2884d07bff286c247bf3d93/image2.png" alt="image2.png" data-proofer-ignore></p><p>As it is observed, each of the control inputs have a non-zero steady state value; positive for thrusters 6,7 and negative for thrusters 5,8.</p><p><strong><em>Reason:</em></strong> Thrusters 5,6,7,8 are used for positional control in the Z direction. When the rover moves to the desired Z coordinate position in the required orientation, the job of the thrusters is not done since the position has to be retained while neutralising an external force. This external force is the buoyancy acting upon the rover since it is designed to be positively buoyant. The values of forcing acting due to weight and buoyancy for the rover under study are:</p><p>W = 112.8 N</p><p>B = 114.8 N ; this implies that the net external force acting on the rover is 2N upwards.</p><p>When we look at thrusters 5,8 ; they provide a thrust vertically upwards when rotated clockwise while thrusters 6,7 produce a thrust vertically downwards for the same. This means that for thrusters 5,8 positive thrust is upwards while negative thrust is downwards. This is opposite in the case of thrusters 6,7 From the plots of control inputs to the above thrusters, the steady state values are as follows:</p><p>For thrusters 5,8: $-1.25*10^{-2}$ (approx.)</p><p>For thrusters 6,7: $+1.25*10^{-2}$ (approx.)</p><p>Thrust produced by thrusters 5,8 is negative, which implies that thrust is produced in the¬† vertically downwards direction.</p><p>Thrust produced by thrusters 6,7 is positive, which again implies that thrust is produced in the vertically downwards direction.</p><p>Total thrust produced $\tau=Ku$ where K= 40 for all the thrusters.</p><p>Total thrust produced in steady state:</p>\[4*1.25*10^{-2}*40=2N\]<p>downwards.</p><p>Since the external force in Z direction has been neutralised, the rover is stabilised once it reaches the desired position.</p><p>This is how the positional control of the underwater rover has been established using the linear PID control method.</p><h2 id="non-linear-controller-model"><span class="mr-2"><strong>Non-Linear Controller Model</strong></span><a href="#non-linear-controller-model" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>For desired positional input as $[1;1;2;0;0;0]$, we got the following results for positional coordinates in world frame:</p><p><strong>Position X:</strong></p><p>Desired output: 1 m</p><p><img data-src="/assets/images/LQR%20Control%20of%20AUV%204aba9c1df2884d07bff286c247bf3d93/Untitled%2016.png" alt="Untitled" data-proofer-ignore></p><p><strong>Position Y:</strong></p><p>Desired output: 1 m</p><p><img data-src="/assets/images/LQR%20Control%20of%20AUV%204aba9c1df2884d07bff286c247bf3d93/Untitled%2017.png" alt="Untitled" data-proofer-ignore></p><p><strong>Position Z:</strong></p><p>Desired output: 2 m</p><p><img data-src="/assets/images/LQR%20Control%20of%20AUV%204aba9c1df2884d07bff286c247bf3d93/Untitled%2018.png" alt="Untitled" data-proofer-ignore></p><p><strong>Orientation $\phi$:</strong></p><p>Desired output: 0 rad</p><p><img data-src="/assets/images/LQR%20Control%20of%20AUV%204aba9c1df2884d07bff286c247bf3d93/Untitled%2019.png" alt="Untitled" data-proofer-ignore></p><p><strong>Orientation $\theta$:</strong></p><p>Desired output: 0 rad</p><p><img data-src="/assets/images/LQR%20Control%20of%20AUV%204aba9c1df2884d07bff286c247bf3d93/Untitled%2020.png" alt="Untitled" data-proofer-ignore></p><p><strong>Orientation $\psi$:</strong></p><p>Desired output: 0 rad</p><p><img data-src="/assets/images/LQR%20Control%20of%20AUV%204aba9c1df2884d07bff286c247bf3d93/Untitled%2021.png" alt="Untitled" data-proofer-ignore></p><p>The controller input plots (controller input for each thruster will be as follows):</p><p><img data-src="/assets/images/LQR%20Control%20of%20AUV%204aba9c1df2884d07bff286c247bf3d93/7.png" alt="7.png" data-proofer-ignore></p><p>So, we can see that the thrust control input for thrusters 5,6,7 and 8 will be: \(-1.375*10^{-2}, 1.375*10^{-2}, 1.375*10^{-2}, -1.375*10^{-2}\) respectively.</p><p>Now, since propeller pair of 5 and 8 will be opposite to that of the pair 6 and 7, we get the total thrust on the ROV in Z-direction as: \(-1.375*10^{-2}*4*40 = 2N\) (approx.), where 40 is the gain.</p><p>So, the force in the vertical direction is balanced.</p><h1 id="lqr-controller"><strong>LQR Controller</strong></h1><h2 id="literature-review-1"><span class="mr-2"><strong>Literature Review</strong></span><a href="#literature-review-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>The PID controller has been one of the most commonly used controllers for a really long time. There have been numerous PID tuning techniques, such as the Ziegler-Nichols method but are insufficient for high-performance control applications. The Linear Quadratic Regulator (LQR) is an optimal control method based on full state feedback. It aims to minimise the quadratic cost function and is then applied to linear systems, hence the name Linear Quadratic Regulator.</p><h3 id="why-lqr-controller"><span class="mr-2"><strong>Why LQR controller?</strong></span><a href="#why-lqr-controller" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>The use of LQR¬† over PID control comes from the higher robustness of the former in terms of tuning the parameters with varying conditions. PID control uses the error in the input parameter of the closed loop system and tunes the parameters to reduce the error to zero. LQR, on the other hand, uses the state space model of the system and takes complete state feedback: -Kx, to calculate the error. LQR uses the method of cost function to calculate the control input cost vs the importance of achieving desired states.</p><h3 id="state-space-model-with-full-state-feedback-gain"><span class="mr-2"><strong>State-Space Model with Full State Feedback Gain</strong></span><a href="#state-space-model-with-full-state-feedback-gain" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><img data-src="/assets/images/LQR%20Control%20of%20AUV%204aba9c1df2884d07bff286c247bf3d93/Untitled%2022.png" alt="Untitled" data-proofer-ignore></p>\[\dot{X}=AX+BU\] \[y=CX+DU\]<h3 id="cost-function"><span class="mr-2"><strong>Cost Function</strong></span><a href="#cost-function" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>The cost function defined by the system equations is minimised by the LQR controller using an optimal control algorithm. The cost function involves the system‚Äôs state parameters and input (control) parameters, along with the Q and R matrices. For the optimal LQR solution, the overall cost function must be as low as possible. The weights given to the state and control parameters are represented by the Q and R matrices, which act as knobs whose values can be varied to adjust the total value of the cost function.</p><p>The system must have a linearized state-space model to solve the LQR optimization problem. The cost function to be optimised is given by</p>\[J=\int{(X^TQX+U^TRU) dt}\]<h3 id="algebraic-riccati-equation-and-its-solution-s-matrix"><span class="mr-2"><strong>Algebraic Riccati Equation and Its Solution ($S$ matrix)</strong></span><a href="#algebraic-riccati-equation-and-its-solution-s-matrix" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>The Q and R matrices are used to solve the Algebraic Riccati Equation (ARE) to compute the full state feedback matrix.</p>\[A^TS+SA-SBR^{-1}B^TS+Q=0\]<p>On solving the above equation, we obtain the matrix $S$.</p><h3 id="feedback-gain-k-and-eigen-values-from-s-matrix"><span class="mr-2"><strong>Feedback Gain (K) and Eigen Values from $S$ matrix</strong></span><a href="#feedback-gain-k-and-eigen-values-from-s-matrix" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>The matrix ùëÜ obtained from the above ARE is used to find the full state feedback gain matrix K using the relation,</p>\[K=R^{-1}B^TS\]<p>The control matrix U is then given by</p>\[U=-KX\]<h3 id="linearisation-of-a-state-space-model"><span class="mr-2"><strong>Linearisation of a state-space model</strong></span><a href="#linearisation-of-a-state-space-model" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>The linearization of a state-space model is needed while using the LQR technique since it works on linear systems. In our case, the state space model is in the form: ·∫ã = f(x); where f(x) is a nonlinear function of x. In such cases, to linearise the equation, we use the concept of linearising about a fixed point. The steps for the same are as follows:</p><ol><li>Find the fixed points $\bar{x}$; where $f(\bar{x})=0.$<li>Linearise about an xÃÑ, by calculating the Jacobian of dynamics at the fixed point xÃÑ; where the latter can be represented as:</ol>\[\mathbf{J}=\left[\begin{array}{ccc}\frac{\partial \mathbf{f}}{\partial x_1} &amp; \cdots &amp; \frac{\partial \mathbf{f}}{\partial x_n}\end{array}\right]=\left[\begin{array}{c}\nabla^{\mathrm{T}} f_1 \\\vdots \\\nabla^{\mathrm{T}} f_m\end{array}\right]=\left[\begin{array}{ccc}\frac{\partial f_1}{\partial x_1} &amp; \cdots &amp; \frac{\partial f_1}{\partial x_n} \\\vdots &amp; \ddots &amp; \vdots \\\frac{\partial f_m}{\partial x_1} &amp; \cdots &amp; \frac{\partial f_m}{\partial x_n}\end{array}\right]\]<p>where each term is a partial derivative of the dynamics with respect to a variable.</p><p>This step is executed since the dynamics of a nonlinear system behave linearly at the fixed point, or, in a small neighbourhood around the fixed point.</p><p>Changing the frame of reference to one with xÃÑ as the origin:</p>\[\dot{x} - \bar{\dot{x}} = f(x) \newline = f(\bar{x}) + J.(x-\bar{x})+J^2.{(x-\bar{x})}^2 + ....\]<p>where¬†$J$ is calculated at $\bar{x}$.</p><p>The higher order terms from the third term $J^2.{(x-\bar{x})}^2$ are neglected since they are really small, hence the equation reduces to:</p><p>‚àÜ·∫ã = 0 +J.‚àÜx + 0</p><p>‚áí ‚àÜ·∫ã = J.‚àÜx</p>\[\Delta\dot{x} = 0+ J.\Delta x + 0 \newline = J.\Delta x\]<p>This is in the form¬†$\dot{x} = Ax$.</p><p><em>Note:</em> The above method for linearization works only when the fixed point satisfies the condition for linearising a system given by the Hartman Grobman Theorem, which states that:</p><p>‚Äú<em>the behaviour of a dynamical system in a domain near a hyperbolic equilibrium point is qualitatively the same as the behaviour of its <a href="https://en.wikipedia.org/wiki/Linearization">linearisation</a> near this equilibrium point, where hyperbolicity means that no eigenvalue of the linearisation has real part equal to zero. Therefore, when dealing with such dynamical systems one can use the simpler linearisation of the system to analyse its behaviour around equilibria.<a href="https://en.wikipedia.org/wiki/Hartman%E2%80%93Grobman_theorem#cite_note-1">[1]</a></em>‚Äù</p><p>Hence, linearization works only when the fixed point is hyperbolic or put simply, has a non-zero real part.</p><h1 id="lqr-implementation">LQR <strong>Implementation</strong></h1><p>The following is the Simulink model that we built:</p><p><img data-src="/assets/images/LQR%20Control%20of%20AUV%204aba9c1df2884d07bff286c247bf3d93/Untitled%2023.png" alt="Untitled" data-proofer-ignore></p><p>To implement this, we need the following:</p><ol><li>State-space model:<ol><li>A and B matrices: These relate the derivative of the states with the current states and the control input. But, since our model is non-linear in nature, we cannot get a direct relation consisting of A and B matrices. Also, the LQR controller works only for Linear Systems. So, we have to linearise our system around an operating point. For our system, we took the origin in the world frame (initial point of the bot) as the operating point. Also, we used the position of the bot in the world frame and velocity of the bot in its own frame as the two states. Meaning:</ol>\[x = \begin{bmatrix} \eta \newline v \end{bmatrix}\]</ol><p>(Here $x$ is the state but not the distance in x direction)</p>\[\begin{aligned}\dot{\boldsymbol{x}} &amp; =\left[\begin{array}{c}\dot{\boldsymbol{\eta}} \\\dot{\boldsymbol{v}}\end{array}\right]=f\left(\boldsymbol{x}, \boldsymbol{u}, \boldsymbol{\tau}_d, t\right) \\&amp; =\left[\begin{array}{c}J(\eta) \boldsymbol{v} \\M^{-1}\left[K p(A \boldsymbol{u})+\tau_d-C(\boldsymbol{v}) \boldsymbol{v}-D(\boldsymbol{v}) \boldsymbol{v}-g(\boldsymbol{\eta})\right]\end{array}\right]\end{aligned}\]<p>Since,</p>\[\dot{\eta} = J(\eta)v\]<p>The above state space model is clearly non-linear. So, we have to linearise to find A and B as follows:</p>\[A(t) \equiv\left[\begin{array}{cccc}\frac{\partial f_1}{\partial x_1} &amp; \frac{\partial f_1}{\partial x_2} &amp; \cdots &amp; \frac{\partial f_1}{\partial x_n} \\\frac{\partial f_2}{\partial x_1} &amp; \frac{\partial f_2}{\partial x_2} &amp; \cdots &amp; \frac{\partial f_2}{\partial x_n} \\&amp; \vdots &amp; \\\frac{\partial f_n}{\partial x_1} &amp; \frac{\partial f_n}{\partial x_2} &amp; \cdots &amp; \frac{\partial f_n}{\partial x_n}\end{array}\right]_0 \newline \newline B(t) \equiv\left[\begin{array}{cccc}\frac{\partial f_1}{\partial u_1} &amp; \frac{\partial f_1}{\partial u_2} &amp; \cdots &amp; \frac{\partial f_1}{\partial u_m} \\ \frac{\partial f_2}{\partial u_1} &amp; \frac{\partial f_2}{\partial u_2} &amp; \cdots &amp; \frac{\partial f_2}{\partial u_m} \\ &amp; \vdots &amp; \\ \frac{\partial f_n}{\partial u_1} &amp; \frac{\partial f_n}{\partial u_2} &amp; \cdots &amp; \frac{\partial f_n}{\partial u_m}\end{array}\right]_0\]<p>So, we obtain the A and B as follows:</p><p><img data-src="/assets/images/LQR%20Control%20of%20AUV%204aba9c1df2884d07bff286c247bf3d93/Untitled%2024.png" alt="Untitled" data-proofer-ignore></p><p><img data-src="/assets/images/LQR%20Control%20of%20AUV%204aba9c1df2884d07bff286c247bf3d93/Untitled%2025.png" alt="Untitled" data-proofer-ignore></p><p>But we obtained the above results by taking weight W and buoyancy B as 110 N and 120 N respectively.</p><ol><li>We take the C matrix in state-space $y = CX+DU$ as $eye(12)$ so as to send back all the states as feedback to the summing point.<li>Q and R matrices:<ol><li>Q stands for the importance of the states to reach their desired values.<li>R stands for the cost of the control input.<li>So, if we have an expensive control input compared to that of our needs to reach the states, we take the Q matrix to be dominating compared to R and vice versa.</ol><li>Then, we calculate the full-state feedback matrix, the Algebraic Riccati Equation and the eigenvalues by using the following command:</ol>\[[K,S,P] = lqr(A,B,Q,R)\]<ol><li>Then, we put the obtained value of the Gain matrix in the state-space model in Simulink. The following results are obtained for different R matrices (Q matrix being a 12x12 identity matrix) and desired states being $[1;2;1;[0;0;0;0;0;0;0;0;0]]$:</ol>\[R = \begin{bmatrix}1 &amp; 0.1 &amp; 0.1 &amp; 0.1 &amp;0.1 &amp;0.1 \\ 0.1 &amp; 1 &amp; 0.1 &amp; 0.1 &amp;0.1 &amp;0.1\\ 0.1 &amp; 0.1 &amp; 1 &amp; 0.1 &amp;0.1 &amp;0.1\\ 0.1 &amp; 0.1 &amp; 0.1 &amp; 1 &amp;0.1 &amp;0.1\\ 0.1 &amp; 0.1 &amp; 0.1 &amp; 0.1 &amp;1 &amp;0.1\\ 0.1 &amp; 0.1 &amp; 0.1 &amp; 0.1 &amp;0.1 &amp;1 \end{bmatrix}\]<p><img data-src="/assets/images/LQR%20Control%20of%20AUV%204aba9c1df2884d07bff286c247bf3d93/Untitled%2026.png" alt="Untitled" data-proofer-ignore></p><p>For the above, the Poles of the closed loop and open loop transfer function are as follows:</p><p><img data-src="/assets/images/LQR%20Control%20of%20AUV%204aba9c1df2884d07bff286c247bf3d93/image%201.png" alt="image.png" data-proofer-ignore></p><p><strong>Poles:</strong></p><p>Closed loop (With the feedback):</p><p><img data-src="/assets/images/LQR%20Control%20of%20AUV%204aba9c1df2884d07bff286c247bf3d93/Untitled%2027.png" alt="Untitled" data-proofer-ignore></p><p>Open loop (Without the feedback):</p><p><img data-src="/assets/images/LQR%20Control%20of%20AUV%204aba9c1df2884d07bff286c247bf3d93/Untitled%2028.png" alt="Untitled" data-proofer-ignore></p><p>Making ‚ÄòR‚Äô more dominant</p>\[R = \begin{bmatrix}3 &amp; 1.1 &amp; 1.1 &amp; 1.1 &amp;1.1 &amp;1.1 \\ 1.1 &amp; 3 &amp; 1.1 &amp; 1.1 &amp;1.1 &amp;1.1\\ 1.1 &amp; 1.1 &amp; 3 &amp; 1.1 &amp;1.1 &amp;1.1\\ 1.1 &amp; 1.1 &amp; 1.1 &amp; 3 &amp;1.1 &amp;1.1\\ 1.1 &amp; 1.1 &amp; 1.1 &amp; 1.1 &amp;3 &amp;1.1\\ 1.1 &amp; 1.1 &amp; 1.1 &amp; 1.1 &amp;1.1 &amp;3 \end{bmatrix}\]<p><img data-src="/assets/images/LQR%20Control%20of%20AUV%204aba9c1df2884d07bff286c247bf3d93/Untitled22.png" alt="Untitled" data-proofer-ignore></p><p>Making ‚ÄòR‚Äô less dominant</p>\[R = \begin{bmatrix}0.11 &amp; 0.01 &amp; 0.01 &amp; 0.01 &amp;0.01 &amp;0.01 \\ 0.01 &amp; 0.11 &amp; 0.01 &amp; 0.01 &amp;0.01 &amp;0.01\\ 0.01 &amp; 0.01 &amp; 0.11 &amp; 0.01 &amp;0.01 &amp;0.01\\ 0.01 &amp; 0.01 &amp; 0.01 &amp; 0.11 &amp;0.01 &amp;0.01\\ 0.01 &amp; 0.01 &amp; 0.01 &amp; 0.01 &amp;0.11 &amp;0.01\\ 0.01 &amp; 0.01 &amp; 0.01 &amp; 0.01 &amp;0.01 &amp;0.11 \end{bmatrix}\]<p><img data-src="/assets/images/LQR%20Control%20of%20AUV%204aba9c1df2884d07bff286c247bf3d93/Untitled%2029.png" alt="Untitled" data-proofer-ignore></p><h3 id="results"><span class="mr-2"><strong>Results</strong></span><a href="#results" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ol><li>Observed states:</ol><p><img data-src="/assets/images/LQR%20Control%20of%20AUV%204aba9c1df2884d07bff286c247bf3d93/Untitled%2030.png" alt="Untitled" data-proofer-ignore></p><p>More dominant ‚ÄòR‚Äô</p><p><img data-src="/assets/images/LQR%20Control%20of%20AUV%204aba9c1df2884d07bff286c247bf3d93/Untitled%2031.png" alt="Untitled" data-proofer-ignore></p><p>Less dominant ‚ÄòR‚Äô</p><p><img data-src="/assets/images/LQR%20Control%20of%20AUV%204aba9c1df2884d07bff286c247bf3d93/Untitled%2032.png" alt="Untitled" data-proofer-ignore></p><p>Thrust i/p to the thrusters:</p><p><img data-src="/assets/images/LQR%20Control%20of%20AUV%204aba9c1df2884d07bff286c247bf3d93/Untitled%2033.png" alt="Untitled" data-proofer-ignore></p><p>More dominant ‚ÄòR‚Äô</p><p><img data-src="/assets/images/LQR%20Control%20of%20AUV%204aba9c1df2884d07bff286c247bf3d93/Untitled%2034.png" alt="Untitled" data-proofer-ignore></p><p>Less dominant ‚ÄòR‚Äô</p><p><img data-src="/assets/images/LQR%20Control%20of%20AUV%204aba9c1df2884d07bff286c247bf3d93/Untitled%2035.png" alt="Untitled" data-proofer-ignore></p><h3 id="band-limited-white-noise"><span class="mr-2"><strong>Band Limited White Noise</strong></span><a href="#band-limited-white-noise" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>We planned on modelling a system with White Noise. So, we used the following control system:</p><p><img data-src="/assets/images/LQR%20Control%20of%20AUV%204aba9c1df2884d07bff286c247bf3d93/Untitled%2036.png" alt="Untitled" data-proofer-ignore></p><p>Where:</p><p><img data-src="/assets/images/LQR%20Control%20of%20AUV%204aba9c1df2884d07bff286c247bf3d93/Untitled%2037.png" alt="Untitled" data-proofer-ignore></p><p>We included a low pass filter for removing noise with frequency greater than 1Hz. With low values of ‚ÄòQ‚Äô we are getting really unstable results as the importance to the states is reduced. Later, we increased the value of Q to allow the states to reach quickly. This made the response of our system better. Taking the reference input as: [0;0;2;1.57;1;0.8;0;0;0;0;0;0];</p><ol><li>$Q = eye(12):$</ol><p>States:</p><p><img data-src="/assets/images/LQR%20Control%20of%20AUV%204aba9c1df2884d07bff286c247bf3d93/Untitled%2038.png" alt="Untitled" data-proofer-ignore></p><p>Thrust provided by each thruster:</p><p><img data-src="/assets/images/LQR%20Control%20of%20AUV%204aba9c1df2884d07bff286c247bf3d93/Untitled%2039.png" alt="Untitled" data-proofer-ignore></p><p>Poles of this system:</p><p><img data-src="/assets/images/LQR%20Control%20of%20AUV%204aba9c1df2884d07bff286c247bf3d93/Untitled%2040.png" alt="Untitled" data-proofer-ignore></p><p>$Q = 1000*eye(12)$:</p><p>States:</p><p><img data-src="/assets/images/LQR%20Control%20of%20AUV%204aba9c1df2884d07bff286c247bf3d93/Untitled%2041.png" alt="Untitled" data-proofer-ignore></p><p>Thrust provided by each thruster:</p><p><img data-src="/assets/images/LQR%20Control%20of%20AUV%204aba9c1df2884d07bff286c247bf3d93/Untitled%2042.png" alt="Untitled" data-proofer-ignore></p><p>Poles of this system:</p><p><img data-src="/assets/images/LQR%20Control%20of%20AUV%204aba9c1df2884d07bff286c247bf3d93/Untitled%2043.png" alt="Untitled" data-proofer-ignore></p><p>Clearly, the response of the system is faster in the second case.</p><p><strong>Note:</strong> In the above two cases, the open loop and closed loop pole plots are drawn without taking the noise into account. The effect of noise is shown only in the ‚ÄòThrust‚Äô and ‚ÄòStates‚Äô plots.</p><p>Also, in the paper that we referred to, they considered noise caused due to the ‚Äòcurrent velocity‚Äô which has a direct effect on the velocity of the rover instead of the torques. So, for that, a Random Number generator block was included in¬† the model as follows:</p><p><img data-src="/assets/images/LQR%20Control%20of%20AUV%204aba9c1df2884d07bff286c247bf3d93/Untitled%2044.png" alt="Untitled" data-proofer-ignore></p><p>The parameters of the noise block are as follows:</p><p><img data-src="/assets/images/LQR%20Control%20of%20AUV%204aba9c1df2884d07bff286c247bf3d93/Untitled%2045.png" alt="Untitled" data-proofer-ignore></p><p>Here, noise is added considering the velocity of current as: $[0.25,0.25,0.25]$ and taking the variance as 0.01 in all the three directions.</p><p>Taking R matrix as: \(R = 1.2*eye(6)+0.8*ones(6)\)</p><p>And Q matrix as: $Q = 1000*eye(12)$</p><p>The results that we obtained for 1 min stop time are:</p><p>States:</p><p><img data-src="/assets/images/LQR%20Control%20of%20AUV%204aba9c1df2884d07bff286c247bf3d93/Untitled%2046.png" alt="Untitled" data-proofer-ignore></p><p>Thrust provided by each thruster:</p><p><img data-src="/assets/images/LQR%20Control%20of%20AUV%204aba9c1df2884d07bff286c247bf3d93/Untitled%2047.png" alt="Untitled" data-proofer-ignore></p><p>Clearly, the thrust output involves too much vibrations.</p><h3 id="analysis-of-eigenvalues"><span class="mr-2"><strong>Analysis of Eigenvalues</strong></span><a href="#analysis-of-eigenvalues" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>When we analyse the change in eigen values while considering the open loop and LQR controlled closed loop systems, for the same values of Q,R we see a clear change in their position in the pole zero plot.</p><p><img data-src="/assets/images/LQR%20Control%20of%20AUV%204aba9c1df2884d07bff286c247bf3d93/Untitled%2048.png" alt="Untitled" data-proofer-ignore></p><p>Considering the above plot, we can see a clear shift in the eigen values in the direction of the negative real axis, ensuring more stability of the system. As we write down the eigen values or the poles of the two systems, the difference becomes evident.</p><p>For $Q=eye(12)$ &amp; \(R = 0.1*ones(12)+0.9*eye(12)\)</p><div class="table-wrapper"><table><thead><tr><th>Open loop poles<th>Closed loop poles<tbody><tr><td>0.0000 + 0.0000i<td>¬† ¬† -6.3274 + 0.0000i<tr><td>¬†¬†¬†0.0000 + 0.0000i<td>¬†¬†-3.2047 + 3.1841i<tr><td>¬†¬†-0.2740 + 4.3867i<td>¬†¬†-3.2047 - 3.1841i<tr><td>¬†¬†-0.2740 - 4.3867i<td>¬†-3.4503 + 2.9329i<tr><td>¬†¬†-0.2633 + 0.0000i<td>¬†¬†-3.4503 - 2.9329i<tr><td>¬†¬†-0.3003 + 4.3834i<td>¬†¬†-0.9222 + 0.4604i<tr><td>¬†¬†-0.3003 - 4.3834i<td>¬†¬†-0.9222 - 0.4604i<tr><td>¬†¬†-0.4067 + 0.0000i<td>¬†¬†-0.8836 + 0.4709i<tr><td>¬†¬†¬†0.0000 + 0.0000i<td>¬†¬†-0.8836 - 0.4709i<tr><td>¬†¬†¬†0.0000 + 0.0000i<td>¬†¬†-1.0104 + 0.0000i<tr><td>¬†¬†-0.4504 + 0.0000i<td>¬†¬†-0.2170 + 0.0000i<tr><td>¬†¬†-0.4375 + 0.0000i<td>¬†¬†-0.4043 + 0.0000i</table></div><p>As it can be observed, in the case of the open loop system, we have four eigen values or poles located at the origin which leads to the fact that the system is marginally stable. Whereas, for the closed loop system, most of¬† the poles have shifted towards the left side of the imaginary axis with all the poles lying on the left half of the s-plane. This gives enough proof to say that after implementing LQR control, the system has become more stable as compared to the open loop system and hence has helped in increasing performance in terms of reaching the end states.</p><h1 id="conclusion"><strong>Conclusion</strong></h1><p>Given the results of implementing both PID and LQR control on the ROV system, we can see a better response for an LQR control over the PID when we include disturbances in the environment. Also, the LQR control is far more robust in adapting to the change in buoyancy as compared to the PID control, which broadens the spectrum of usage in the former as compared to the latter. When we have changes in the system, using a PID requires tuning all the three gain values for all the control inputs. Tuning the gain values for multiple parameters is not an easy task and there is a very narrow range of values which give the desired results for a specific situation. On the other hand, when we want to adapt to changes while working on LQR control, our tuning is dependent only on the Q,R cost matrices which can help in changing the¬† relative importance of the states and control inputs for a given circumstance. Here, our goal is achieved by changing the values of the matrices, so as to select the more important factor among the states and inputs,¬† where we achieve the desired results for a wide range of values which only differ in terms of speed of transient response and steady state error. Another advantage of LQR over PID control that we have come across was the ability to easily control velocity components along with the position coordinates, which would lead to much more complexity in the case of a PID based controller. For simulating in a noisy environment, we used nonlinear PID control where a water current velocity was added as a disturbance; its value being constant with time and we attained appreciable results. Whereas for the LQR setup, we have used a gaussian white noise as a source of disturbance, which gives a better look at the real world scenario. Upon increasing the Q matrix or simply, the cost of attaining the states, we have observed better performance in attaining the states and less erratic, more uniform thrust outputs produced by the thrusters; which is a more reliable result since it is realisable in a real world environment.</p><p>However, one drawback of using the LQR control is its applicability to only linear systems, whereas most of the real world scenarios tend to have non linearity in them. However, this problem can be overcome by linearising the system near the fixed points and applying the control.</p><p>Hence, we have come to the conclusion that using an LQR control is <strong>far more reliable</strong> than a PID control for the positional and velocity control of a 6-DOF Autonomous Underwater Vehicle.</p><h1 id="future-work"><strong>Future Work</strong></h1><ul><li>The model can be implemented with an Adaptive Controller based system which is expected to give better performance.<li>We wish to implement our work on the actual physical system to know how it works in the real world. And by doing that, we will be able to understand how the sensor noise affects the system and how the controller will compensate for it.</ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/projects/'>Projects</a>, <a href='/categories/robotics/'>Robotics</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/control/" class="post-tag no-text-decoration" >control</a> <a href="/tags/lqr/" class="post-tag no-text-decoration" >lqr</a> <a href="/tags/pid/" class="post-tag no-text-decoration" >pid</a> <a href="/tags/simulink/" class="post-tag no-text-decoration" >simulink</a> <a href="/tags/matlab/" class="post-tag no-text-decoration" >matlab</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://www.facebook.com/sharer/sharer.php?title=Thruster+Control+of+AUV+Using+LQR+-+Bhaswanth+Ayapilla&u=https%3A%2F%2Fbhaswanth-a.github.io%2F%2Fposts%2Flqr-control%2F" data-toggle="tooltip" data-placement="top" title="Instagram" target="_blank" rel="noopener" aria-label="Instagram"> <i class="fa-fw fab fa-instagram"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Thruster+Control+of+AUV+Using+LQR+-+Bhaswanth+Ayapilla&u=https%3A%2F%2Fbhaswanth-a.github.io%2F%2Fposts%2Flqr-control%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fbhaswanth-a.github.io%2F%2Fposts%2Flqr-control%2F&text=Thruster+Control+of+AUV+Using+LQR+-+Bhaswanth+Ayapilla" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fbhaswanth-a.github.io%2F%2Fposts%2Flqr-control%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/intro-to-rl/">Introduction to Reinforcement Learning</a><li><a href="/posts/reinforcement-learning/">Reinforcement Learning</a><li><a href="/posts/deep-rl/">Deep Reinforcement Learning</a><li><a href="/posts/lunar-roadster-cmu/">Lunar ROADSTER</a><li><a href="/posts/cmu-blog/">Coursework at CMU</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/learning/">learning</a> <a class="post-tag" href="/tags/nnets/">nnets</a> <a class="post-tag" href="/tags/rl/">rl</a> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/arduino/">arduino</a> <a class="post-tag" href="/tags/computer-vision/">computer vision</a> <a class="post-tag" href="/tags/control/">control</a> <a class="post-tag" href="/tags/electronics/">electronics</a> <a class="post-tag" href="/tags/manipulators/">manipulators</a> <a class="post-tag" href="/tags/ml/">ml</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/asv/"><div class="card-body"> <em class="small" data-ts="1701705600" data-df="ll" > Dec 4, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Controller for Autonomous Surface Vehicle</h3><div class="text-muted small"><p> The following project was completed as part of a competition at the Institute for Systems and Robotics, Lisbon under the supervision of Dr. David Cabecinhas and Dr. Pedro Batista</p></div></div></a></div><div class="card"> <a href="/posts/aug-simulator/"><div class="card-body"> <em class="small" data-ts="1701705600" data-df="ll" > Dec 4, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Development of Python-Based Simulator for Analyzing Autonomous Underwater Glider Motions and Performance</h3><div class="text-muted small"><p> The following project was completed as part of my undergraduate thesis at the Institute for Systems and Robotics, Lisbon under the supervision of Dr. David Cabecinhas and Dr. Pedro Batista Abstr...</p></div></div></a></div><div class="card"> <a href="/posts/mec-24/"><div class="card-body"> <em class="small" data-ts="1733328000" data-df="ll" > Dec 4, 2024 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Manipulation, Estimation, and Control</h3><div class="text-muted small"><p> Controls Estimation Your browser does not support PDFs. Please download the report here. Manipulation</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/transnomous/" class="btn btn-outline-primary" prompt="Older"><p>Autonomous Ground Vehicle</p></a> <a href="/posts/sauvc-acoustic/" class="btn btn-outline-primary" prompt="Newer"><p>Acoustic Localization</p></a></div><script type="text/javascript"> $(function () { const origin = "https://giscus.app"; const iframe = "iframe.giscus-frame"; const lightTheme = "light"; const darkTheme = "dark_dimmed"; let initTheme = lightTheme; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = darkTheme; } let giscusAttributes = { "src": "https://giscus.app/client.js", "data-repo": "Bhaswanth-A/bhaswanth-a.github.io", "data-repo-id": "R_kgDOHu5z_w", "data-category": "General", "data-category-id": "DIC_kwDOHu5z_84C0yVx", "data-mapping": "pathname", "data-reactions-enabled": "1", "data-emit-metadata": "0", "data-theme": initTheme, "data-input-position": "bottom", "data-lang": "en", "crossorigin": "anonymous", "async": "" }; let giscusScript = document.createElement("script"); Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value)); document.getElementById("tail-wrapper").appendChild(giscusScript); addEventListener("message", (event) => { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* global theme mode changed */ const mode = event.data.message; const theme = (mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme); const message = { setConfig: { theme: theme } }; const giscus = document.querySelector(iframe).contentWindow; giscus.postMessage({ giscus: message }, origin); } }); }); </script></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> ¬© 2026 <a href="https://github.com/Bhaswanth-A">Bhaswanth Ayapilla</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/learning/">learning</a> <a class="post-tag" href="/tags/nnets/">nnets</a> <a class="post-tag" href="/tags/rl/">rl</a> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/arduino/">arduino</a> <a class="post-tag" href="/tags/computer-vision/">computer vision</a> <a class="post-tag" href="/tags/control/">control</a> <a class="post-tag" href="/tags/electronics/">electronics</a> <a class="post-tag" href="/tags/manipulators/">manipulators</a> <a class="post-tag" href="/tags/ml/">ml</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script> <script> $(function() { function updateMermaid(event) { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { const mode = event.data.message; if (typeof mermaid === "undefined") { return; } let expectedTheme = (mode === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* Re-render the SVG ‚Ä∫ <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } let initTheme = "default"; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches ) ) { initTheme = "dark"; } let mermaidConf = { theme: initTheme /* <default|dark|forest|neutral> */ }; /* Markdown converts to HTML */ $("pre").has("code.language-mermaid").each(function() { let svgCode = $(this).children().html(); $(this).addClass("unloaded"); $(this).after(`<div class=\"mermaid\">${svgCode}</div>`); }); mermaid.initialize(mermaidConf); window.addEventListener("message", updateMermaid); }); </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */ MathJax = { tex: { inlineMath: [ /* start/end delimiter pairs for in-line math */ ['$','$'], ['\\(','\\)'] ], displayMath: [ /* start/end delimiter pairs for display math */ ['$$', '$$'], ['\\[', '\\]'] ] } }; </script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"> </script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-CJ97GH1VYR"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-CJ97GH1VYR'); }); </script>
